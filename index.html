<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="favicon.ico" />
    <script type="module" src="/src/bootstrap.js"></script>
    <link rel="stylesheet" href="/src/styles.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pointillate</title>
  </head>
  <body>
    <div id="app" class="loading">
      <div id="titlePane">
        <h1 class="title">Pointillate</h1>
      </div>
      <!-- <div id="loader" class="loader"></div> -->

      <div id="canvasStage">
        <div id="canvasVisual">
          <canvas id="canvas"></canvas>
        </div>
      </div>

      <div id="controlPane">
        <div id="controlDock">

          <wa-button id="infoButton" size="small" appearance="filled"
            aria-label="About">
            <wa-icon name="info"></wa-icon>
          </wa-button>

          <wa-button id="optionsButton" size="small" appearance="filled"
            aria-label="Edit options">
            <wa-icon id="optionsIcon" name="sliders"></wa-icon>
          </wa-button>

          <!-- <wa-tooltip for="uploadButton">Upload Your Own</wa-tooltip> -->
          <wa-button id="uploadButton" size="small" appearance="filled"
            aria-label="Choose file">
            <wa-icon name="plus"></wa-icon>
          </wa-button>

          <wa-button appearance="filled" id="resetButton"
            size="small" aria-label="Reset"><wa-icon
              name="arrows-rotate"></wa-icon></wa-button>

          <wa-button id="runButton" size="small" appearance="filled"
            aria-label="Play/Pause">
            <wa-icon id="runIcon" name="play"></wa-icon>
          </wa-button>

        </div>

        <div id="controlCarousel">
          <div class="carouselPad">

            <div class="controlTrack">

              <div class="controlCard pickerWidth">
                <div class="colorPickers">
                  <wa-color-picker id="backgroundColorBtn" label="Canvas"
                    placement="left" hoist
                    value="#FFFFFF" size="small"
                    swatches="#000; #fff"></wa-color-picker>
                  <wa-color-picker id="pointColorBtn" label="Points"
                    value="#000000" size="small"
                    swatches="#000; #fff"></wa-color-picker>
                  <wa-color-picker id="lineColorBtn" label="Lines"
                    value="#000000" size="small"
                    swatches="#000; #fff"></wa-color-picker>
                </div>
              </div>

              <div class="controlCard sliderWidth" id="cardToStart">
                <div class="checks">
                  <wa-switch checked id="pointToggle">Points</wa-switch>
                  <wa-switch id="cellToggle">Cells</wa-switch>
                  <wa-switch id="colorToggle">Colors</wa-switch>
                </div>
              </div>
              <div class="controlCard sliderWidth">
                <wa-slider with-tooltip
                  id="numPointsSlider"
                  label="Point Count"
                  min="1000"
                  max="30000"
                  value="2000"
                  step="1000">
                </wa-slider>
              </div>

              <div class="controlCard">
                <wa-select id="seedSelect" size="medium" label="Start from">
                  <wa-option value="seedDark" icon-placement="start"
                    label="Dark Areas" selected>Dark
                    Areas</wa-option>
                  <wa-option value="seedLight" icon-placement="start"
                    label="Light Areas">Light Areas</wa-option>
                  <wa-option value="seedRandom" icon-placement="start"
                    label="All Over">All Over</wa-option>
                </wa-select>
              </div>

              <div class="controlCard">
                <wa-select id="relaxSelect" size="medium" label="Relax to">
                  <wa-option value="relaxDark" label="Dark Areas"
                    selected>Dark Areas</wa-option>
                  <wa-option value="relaxLight" label="Light Areas">Light
                    Areas</wa-option>
                </wa-select>
              </div>

              <div class="controlCard">
                <wa-select id="sizeSelect" size="medium" label="Size by">
                  <wa-option value="sizeDark" label="Darkness"
                    selected>Darkness</wa-option>
                  <wa-option value="sizeLight"
                    label="Lightness">Lightness</wa-option>
                  <wa-option value="sizeNone"
                    label="Nothing">Nothing</wa-option>
                </wa-select>
              </div>
              <div class="controlCard sliderWidth">
                <wa-slider range with-tooltip
                  id="radiusRange"
                  label="Point Size"
                  min="0"
                  max="10"
                  value="1.5"
                  min-value="1"
                  max-value="4"
                  step="0.1"></wa-slider>
                <wa-slider with-tooltip
                  id="radiusSlider"
                  label="Point Size"
                  min="0"
                  max="10"
                  value="2"
                  step="0.1"
                  style="display:none;">
                </wa-slider>
              </div>

              <div class="controlCard sliderWidth">
                <wa-slider with-tooltip
                  id="speedSlider"
                  label="Speed"
                  min="0"
                  max="1"
                  value="0.1"
                  step="0.01"></wa-slider>
              </div>

              <div class="controlCard saveButtonCard"
                style="position:relative;">
                <div class="cardCenter">
                  <wa-dropdown id="saveDropdown" placement="top-middle">
                    <wa-button size="large" slot="trigger"
                      appearance="filled"><wa-icon
                        name="download"></wa-icon></wa-button>
                    <wa-dropdown-item value="png">PNG</wa-dropdown-item>
                    <wa-dropdown-item value="json">JSON</wa-dropdown-item>
                  </wa-dropdown>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="infoOverlay" class="info-overlay">
      <div class="info-panel-outer">
        <div class="info-panel-inner">
          <wa-button id="closeInfo" size="medium" appearance="plain"
            aria-label="Close">
            <wa-icon name="close"></wa-icon>
          </wa-button>
          <h1>Pointillate</h1>
          <p class="byline">Interactive by <a
              href="http://www.willkoeppen.com/datavis">Will
              Koeppen</a></p>
          <p>Artists have used distributed dots for shading since at least <a
              href="https://en.wikipedia.org/wiki/Stipple_engraving">1510
              AD</a>.
            In the late 1800s, the <a
              href="https://en.wikipedia.org/wiki/Pointillism">Pointillism</a>
            movement shed lines altogether and used only dots (of paint).
            Computer scientists like <a
              href="https://kops.uni-konstanz.de/server/api/core/bitstreams/357c2128-47cb-44bf-ac9d-734cdf9012a6/content">Deussen
              et al. (2000)</a> and <a
              href="https://www.cs.ubc.ca/labs/imager/tr/2002/secord2002b/secord.2002b.pdf">Secord
              (2002)</a> explored algorithms to replicate those techniques.</p>
          <p>As a lover of art and animation, I'm very interested in the
            idea of visual sufficiency. How little of something can you show and
            have people recognize what it is? Will 10,000 circles suffice over 4
            million pixels? This project allows us to play with
            that idea, and others.</p>

          <h2>How this works</h2>
          <p>First, we seed the canvas. We throw particles at random, but we
            only allow them to "stick" to dark or light areas of the reference
            image.</p>

          <p>Next, the particles are allowed to relax using
            <a
              href="https://en.wikipedia.org/wiki/Lloyd%27s_algorithm">Lloyd&#39;s
              Algorithm</a>. This step iteratively calculates a <a
              href="Voronoi_diagram">Voronoi diagram</a> with the points, and it
            moves each one towards the center of mass within of its own cell.
            Generally speaking, this looks like particles move away from being
            on top of each other and whatever has weight.</p>
          <p> But what has weight? We can redefine it. Typically these
            algorithms would seed</p>

          <p>For images, the movement you see is the particles shifting towards
            a
            new equilibrium that&#39;s dictated by whatever we consider to have
            weight â€” either brightness or darkness. But equilibrium is fleeting,
            because once the particles have moved, we must recalculate the
            Voronoi
            cells, which changes the weight distribution within the cell, and
            then
            the particles must move again, and on and on.</p>
          <p>For video, each frame is rendered with one relaxation iteration.
            The
            relaxation still works pretty well though, because each video frame
            is, for the most part, very similar to the previous one.</p>
          <p>This application allows you to pointillate your own images and/or
            videos. You can add additional points, change where seeds are
            placed,
            decide what parts of the image should have gravity, scale the point
            size with their weight, etc. Selecting colors fills either the
            circle
            or the cell with the color immediately underneath the moving Voronoi
            cell centroid, which can have some interesting effects.</p>
          <p>Acknowledgements: Daniel Shiffman&#39;s <a
              href="https://thecodingtrain.com/challenges/181-image-stippling">Coding
              Train Challenge #181</a> is was an excellent resource, and <a
              href="https://github.com/smallwhale1/voronoi-stippling/tree/main">Sophie
              Zhang</a>&#39;s response to the challange was an inspiring seed
            for
            my own iteration.</p>
        </div>
      </div>
    </div>

    <div class="behindTheVeil">
      <video id="video" playsinline muted
        style="display: none"></video>
      <input
        type="file"
        aria-label="Upload image or video"
        id="mediaUploadDialog"
        accept="image/*,video/*,.mp4,.mov,.webm"
        hidden
        tabindex="-1" />
    </div>

  </body>
</html>